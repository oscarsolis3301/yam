<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Global chart variable
let outageChart;

document.addEventListener('DOMContentLoaded', function() {
    console.log('YAM Core Scripts: DOM Content Loaded');
    
    // Initialize chart
    const ctx = document.getElementById('outageChart');
    if (ctx) {
        console.log('Found outage chart canvas, initializing...');
        try {
            outageChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Outages',
                        data: [],
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#dc3545',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#999'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)'
                            },
                            ticks: {
                                color: '#999',
                                beginAtZero: true
                            }
                        }
                    }
                }
            });
            console.log('Outage chart initialized successfully');
        } catch (error) {
            console.error('Error initializing outage chart:', error);
        }
    } else {
        console.warn('Outage chart canvas not found');
    }

    // Load real data
    console.log('Loading initial outages data...');
    if (typeof loadOutagesData === 'function') {
        loadOutagesData('14d'); // Changed default from 7d to 14d
    } else {
        console.warn('loadOutagesData function not available');
    }
    
    if (typeof loadUserActivity === 'function') {
        loadUserActivity();
    } else {
        console.warn('loadUserActivity function not available');
    }

    // Time period controls
    const timeButtons = document.querySelectorAll('.time-btn');
    console.log('Found', timeButtons.length, 'time period buttons');
    
    timeButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            console.log('Time button clicked:', this.dataset.period);
            if (this.id === 'customDateBtn') {
                if (typeof openCustomDateModal === 'function') {
                    openCustomDateModal();
                } else {
                    console.warn('openCustomDateModal function not available');
                }
                return;
            }
            
            document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            if (typeof loadOutagesData === 'function') {
                loadOutagesData(this.dataset.period);
            } else {
                console.warn('loadOutagesData function not available');
            }
        });
    });

    // Refresh data every 30 seconds
    setInterval(() => {
        const activeBtn = document.querySelector('.time-btn.active');
        if (activeBtn && activeBtn.id !== 'customDateBtn') {
            if (typeof loadOutagesData === 'function') {
                loadOutagesData(activeBtn.dataset.period);
            }
        }
        if (typeof loadUserActivity === 'function') {
            loadUserActivity();
        }
    }, 30000);
    
    console.log('YAM Core Scripts: Initialization complete');
});
</script> 