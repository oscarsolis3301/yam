{% extends "base.html" %}

{% block content %}
<!-- MODULAR YAM DASHBOARD - Clean and Organized -->
<script>
// CRITICAL: Static outages configuration
window.YAM_STATIC_OUTAGES = {
    enabled: true,
    loaded: false,
    data: null,
    lastLoad: 0
};

// CRITICAL: Global emergency throttle for session activity
window.YAM_EMERGENCY_THROTTLE = {
    lastCall: 0,
    callCount: 0,
    blocked: 0
};

// Override fetch to block excessive session activity calls
const originalFetch = window.fetch;
window.fetch = function(url, options) {
    if (url && url.includes('/api/session/activity')) {
        const now = Date.now();
        const throttle = window.YAM_EMERGENCY_THROTTLE;
        
        if ((now - throttle.lastCall) < 600000) {
            throttle.blocked++;
            console.debug(`ðŸš« Blocked session activity call #${throttle.blocked} - throttling active`);
            return Promise.resolve(new Response('{"success":true,"throttled":true}', {
                status: 200,
                headers: { 'Content-Type': 'application/json' }
            }));
        }
        
        throttle.lastCall = now;
        throttle.callCount++;
        console.log(`âœ… Allowing session activity call #${throttle.callCount}`);
    }
    return originalFetch.apply(this, arguments);
};

console.log('YAM: Enhanced session management initialized');
</script>

<!-- DASHBOARD LAYOUT -->
<div class="dashboard-container">
    <!-- Welcome Header -->
    {% include 'components/yam/yam_welcome_header.html' %}

    <!-- Main Dashboard Grid -->
    <div class="dashboard-grid">
        <!-- Sidebar -->
        <div class="sidebar">
            {% include 'components/yam/yam_user_profile.html' %}
        </div>

        <!-- Main Content -->
        <div class="yam-main-content">
            <!-- Charts Grid -->
            <div class="charts-grid">
                {% include 'components/yam/yam_outages_section.html' %}
                {% include 'components/yam/yam_user_tickets_section.html' %}
            </div>
            
            <!-- Dashboard Widgets -->
            {% include 'components/yam/yam_dashboard_widgets.html' %}
        </div>
    </div>

    <!-- Navigation Directory -->
    {% include 'components/yam/yam_navigation_directory.html' %}
</div>

<!-- MODALS -->
{% include 'components/yam/yam_outage_detail_modal.html' %}
{% include 'components/yam/yam_custom_date_modal.html' %}
{% include 'components/yam/yam_outages_management_modal.html' %}

<!-- STYLES - IN CORRECT ORDER -->
{% include 'components/yam/yam_dashboard_styles.html' %}
{% include 'components/yam/yam_unified_chart_styles.html' %}
{% include 'components/yam/yam_modal_styles.html' %}

<!-- RESPONSIVE LAYOUT FIX - NO SCALING, NO GAPS -->
<style>
/* CRITICAL: Remove all scaling and implement responsive layout */
.dashboard-container {
    /* Remove all scaling - use natural dimensions */
    transform: none !important;
    transform-origin: initial !important;
    width: 100% !important;
    max-width: 100% !important;
    margin: 0 !important;
    position: relative !important;
    height: auto !important;
    z-index: 1 !important;
    
    /* Ensure proper padding and spacing */
    padding: 1rem !important;
    box-sizing: border-box !important;
    background: linear-gradient(135deg, #000000 0%, #0a0a0a 50%, #000000 100%) !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 1rem !important;
    min-height: 100vh !important;
}

/* RESPONSIVE GRID LAYOUT - NO GAPS */
.dashboard-grid {
    display: grid !important;
    grid-template-columns: minmax(320px, 350px) 1fr !important;
    gap: 1rem !important;
    margin-bottom: 0 !important;
    flex: 1 !important;
    min-height: 0 !important;
    align-items: start !important;
    width: 100% !important;
    max-width: 100% !important;
}

/* SIDEBAR - FIXED WIDTH, NO GAPS */
.sidebar {
    display: flex !important;
    flex-direction: column !important;
    gap: 1rem !important;
    height: 100% !important;
    align-self: start !important;
    width: 100% !important;
    max-width: 350px !important;
    min-width: 320px !important;
    flex-shrink: 0 !important;
}

/* MAIN CONTENT - FLEXIBLE, NO GAPS */
.yam-main-content {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 1rem !important;
    width: 100% !important;
    min-width: 0 !important;
    flex: 1 !important;
}

/* CHARTS GRID - RESPONSIVE, NO GAPS */
.charts-grid {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 1rem !important;
    margin-bottom: 0 !important;
    flex-shrink: 0 !important;
    width: 100% !important;
    min-width: 0 !important;
}

/* ENSURE ALL CHART CONTAINERS MAINTAIN PRECISE MOUSE EVENTS */
.charts-grid,
.yam-outages-section,
.yam-user-tickets-section,
.dashboard-widgets {
    /* Remove any transform interference */
    transform: none !important;
    transform-origin: initial !important;
    
    /* Ensure proper positioning */
    position: relative !important;
    z-index: 2 !important;
    width: 100% !important;
    max-width: 100% !important;
}

/* SPECIFIC CHART CONTAINER PRECISION */
.chart-container,
canvas,
svg {
    /* Ensure charts maintain precise mouse coordinates */
    transform: none !important;
    transform-origin: initial !important;
    
    /* Maintain proper positioning for tooltips and interactions */
    position: relative !important;
    z-index: 3 !important;
    width: 100% !important;
    height: auto !important;
}

/* RESPONSIVE BREAKPOINTS - MAINTAIN EXACT FORMATTING */
@media (max-width: 1400px) {
    .dashboard-grid {
        grid-template-columns: minmax(300px, 320px) 1fr !important;
        gap: 0.8rem !important;
    }
    
    .sidebar {
        max-width: 320px !important;
        min-width: 300px !important;
    }
}

@media (max-width: 1200px) {
    .dashboard-grid {
        grid-template-columns: minmax(280px, 300px) 1fr !important;
        gap: 0.6rem !important;
    }
    
    .sidebar {
        max-width: 300px !important;
        min-width: 280px !important;
    }
    
    .charts-grid {
        gap: 0.8rem !important;
    }
}

@media (max-width: 1024px) {
    .dashboard-grid {
        grid-template-columns: minmax(260px, 280px) 1fr !important;
        gap: 0.5rem !important;
    }
    
    .sidebar {
        max-width: 280px !important;
        min-width: 260px !important;
    }
    
    .charts-grid {
        gap: 0.6rem !important;
    }
}

@media (max-width: 900px) {
    .dashboard-grid {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
    }
    
    .sidebar {
        max-width: 100% !important;
        min-width: 100% !important;
        order: 2 !important;
    }
    
    .yam-main-content {
        order: 1 !important;
    }
    
    .charts-grid {
        grid-template-columns: 1fr !important;
        gap: 1rem !important;
    }
}

@media (max-width: 600px) {
    .dashboard-container {
        padding: 0.5rem !important;
        gap: 0.8rem !important;
    }
    
    .dashboard-grid {
        gap: 0.8rem !important;
    }
    
    .charts-grid {
        gap: 0.8rem !important;
    }
    
    .sidebar {
        gap: 0.8rem !important;
    }
    
    .yam-main-content {
        gap: 0.8rem !important;
    }
}

/* ENSURE NO HORIZONTAL SCROLLING */
body {
    overflow-x: hidden !important;
    width: 100% !important;
    max-width: 100% !important;
}

/* CRITICAL: Disable page scrolling when modal is open */
body.modal-open {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
    top: 0 !important;
    left: 0 !important;
}

html.modal-open {
    overflow: hidden !important;
}

/* CRITICAL: Force disable page scrollbar when ANY modal is open */
body:has(.widget-modal.show),
body:has(.yam-modal-overlay.show),
body:has(.custom-date-modal.show),
body:has(.performance-modal.show),
body:has(.admin-sync-modal.show),
body:has(.user-ticket-details-modal.show),
body:has(.reminder-modal.show),
body:has(#calendarModal.show),
body:has(#calendarEventModal.show),
body:has(#playlistModal.show),
body:has(#reminderModal.show) {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
    top: 0 !important;
    left: 0 !important;
}

html:has(.widget-modal.show),
html:has(.yam-modal-overlay.show),
html:has(.custom-date-modal.show),
html:has(.performance-modal.show),
html:has(.admin-sync-modal.show),
html:has(.user-ticket-details-modal.show),
html:has(.reminder-modal.show),
html:has(#calendarModal.show),
html:has(#calendarEventModal.show),
html:has(#playlistModal.show),
html:has(#reminderModal.show) {
    overflow: hidden !important;
}

/* ENSURE ALL CARDS AND WIDGETS FIT PROPERLY */
.card,
.outages-card,
.user-profile,
.welcome-header {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    margin: 0 !important;
}

/* CRITICAL: Hide all non-modal elements when any modal is active */
.widget-modal.show ~ *,
.yam-modal-overlay.show ~ *,
.custom-date-modal.show ~ *,
.performance-modal.show ~ *,
.admin-sync-modal.show ~ *,
.user-ticket-details-modal.show ~ *,
.reminder-modal.show ~ *,
#calendarModal.show ~ *,
#calendarEventModal.show ~ *,
#playlistModal.show ~ *,
#reminderModal.show ~ * {
    visibility: hidden !important;
    pointer-events: none !important;
}

/* CRITICAL: Specifically hide media player widget when any modal is active */
.widget-modal.show ~ .media-player-widget,
.yam-modal-overlay.show ~ .media-player-widget,
.custom-date-modal.show ~ .media-player-widget,
.performance-modal.show ~ .media-player-widget,
.admin-sync-modal.show ~ .media-player-widget,
.user-ticket-details-modal.show ~ .media-player-widget,
.reminder-modal.show ~ .media-player-widget,
#calendarModal.show ~ .media-player-widget,
#calendarEventModal.show ~ .media-player-widget,
#playlistModal.show ~ .media-player-widget,
#reminderModal.show ~ .media-player-widget,
.widget-modal.show ~ .widget.media-player-widget,
.yam-modal-overlay.show ~ .widget.media-player-widget,
.custom-date-modal.show ~ .widget.media-player-widget,
.performance-modal.show ~ .widget.media-player-widget,
.admin-sync-modal.show ~ .widget.media-player-widget,
.user-ticket-details-modal.show ~ .widget.media-player-widget,
.reminder-modal.show ~ .widget.media-player-widget,
#calendarModal.show ~ .widget.media-player-widget,
#calendarEventModal.show ~ .widget.media-player-widget,
#playlistModal.show ~ .widget.media-player-widget,
#reminderModal.show ~ .widget.media-player-widget {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    position: absolute !important;
    z-index: -9999 !important;
    transform: translateX(-9999px) !important;
    width: 0 !important;
    height: 0 !important;
    overflow: hidden !important;
}

/* CRITICAL: Ensure modal content is always visible and interactive */
.widget-modal.show,
.yam-modal-overlay.show,
.custom-date-modal.show,
.performance-modal.show,
.admin-sync-modal.show,
.user-ticket-details-modal.show,
.reminder-modal.show,
#calendarModal.show,
#calendarEventModal.show,
#playlistModal.show,
#reminderModal.show {
    visibility: visible !important;
    pointer-events: auto !important;
}

/* CRITICAL: Hide media player widget when ANY modal is active anywhere in the document */
.widget-modal.show ~ .media-player-widget,
.yam-modal-overlay.show ~ .media-player-widget,
.custom-date-modal.show ~ .media-player-widget,
.performance-modal.show ~ .media-player-widget,
.admin-sync-modal.show ~ .media-player-widget,
.user-ticket-details-modal.show ~ .media-player-widget,
.reminder-modal.show ~ .media-player-widget,
#calendarModal.show ~ .media-player-widget,
#calendarEventModal.show ~ .media-player-widget,
#playlistModal.show ~ .media-player-widget,
#reminderModal.show ~ .media-player-widget,
.widget-modal.show ~ .widget.media-player-widget,
.yam-modal-overlay.show ~ .widget.media-player-widget,
.custom-date-modal.show ~ .widget.media-player-widget,
.performance-modal.show ~ .widget.media-player-widget,
.admin-sync-modal.show ~ .widget.media-player-widget,
.user-ticket-details-modal.show ~ .widget.media-player-widget,
.reminder-modal.show ~ .widget.media-player-widget,
#calendarModal.show ~ .widget.media-player-widget,
#calendarEventModal.show ~ .widget.media-player-widget,
#playlistModal.show ~ .widget.media-player-widget,
#reminderModal.show ~ .widget.media-player-widget,
/* Also target media player widget anywhere in the document when any modal is active */
body:has(.widget-modal.show) .media-player-widget,
body:has(.yam-modal-overlay.show) .media-player-widget,
body:has(.custom-date-modal.show) .media-player-widget,
body:has(.performance-modal.show) .media-player-widget,
body:has(.admin-sync-modal.show) .media-player-widget,
body:has(.user-ticket-details-modal.show) .media-player-widget,
body:has(.reminder-modal.show) .media-player-widget,
body:has(#calendarModal.show) .media-player-widget,
body:has(#calendarEventModal.show) .media-player-widget,
body:has(#playlistModal.show) .media-player-widget,
body:has(#reminderModal.show) .media-player-widget,
body:has(.widget-modal.show) .widget.media-player-widget,
body:has(.yam-modal-overlay.show) .widget.media-player-widget,
body:has(.custom-date-modal.show) .widget.media-player-widget,
body:has(.performance-modal.show) .widget.media-player-widget,
body:has(.admin-sync-modal.show) .widget.media-player-widget,
body:has(.user-ticket-details-modal.show) .widget.media-player-widget,
body:has(.reminder-modal.show) .widget.media-player-widget,
body:has(#calendarModal.show) .widget.media-player-widget,
body:has(#calendarEventModal.show) .widget.media-player-widget,
body:has(#playlistModal.show) .widget.media-player-widget,
body:has(#reminderModal.show) .widget.media-player-widget {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    position: absolute !important;
    z-index: -9999 !important;
    transform: translateX(-9999px) !important;
    width: 0 !important;
    height: 0 !important;
    overflow: hidden !important;
}

.widget-modal.show *,
.yam-modal-overlay.show *,
.custom-date-modal.show *,
.performance-modal.show *,
.admin-sync-modal.show *,
.user-ticket-details-modal.show *,
.reminder-modal.show *,
#calendarModal.show *,
#calendarEventModal.show *,
#playlistModal.show *,
#reminderModal.show * {
    visibility: visible !important;
    pointer-events: auto !important;
}

/* ENSURE CHARTS RESPOND PROPERLY */
.chart-container {
    width: 100% !important;
    height: auto !important;
    min-height: 300px !important;
    max-height: 500px !important;
}

/* ENSURE NAVIGATION DIRECTORY RESPONDS PROPERLY */
.directory-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)) !important;
    gap: 1rem !important;
    margin-top: 0.5rem !important;
    width: 100% !important;
    max-width: 100% !important;
}

.directory-item {
    width: 100% !important;
    max-width: 100% !important;
    box-sizing: border-box !important;
    margin: 0 !important;
}

/* RESPONSIVE NAVIGATION DIRECTORY BREAKPOINTS */
@media (max-width: 1200px) {
    .directory-grid {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)) !important;
        gap: 0.8rem !important;
    }
}

@media (max-width: 900px) {
    .directory-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
        gap: 0.6rem !important;
    }
}

@media (max-width: 600px) {
    .directory-grid {
        grid-template-columns: 1fr !important;
        gap: 0.8rem !important;
    }
    
    .directory-item {
        padding: 1.2rem !important;
    }
    
    .directory-icon {
        width: 40px !important;
        height: 40px !important;
        margin-right: 1rem !important;
        font-size: 1.2rem !important;
    }
    
    .directory-name {
        font-size: 0.95rem !important;
    }
    
    .directory-desc {
        font-size: 0.75rem !important;
    }
}

/* ENSURE MODALS WORK PROPERLY WITHOUT SCALING */
.widget-modal,
.yam-modal-overlay,
.custom-date-modal,
.performance-modal,
.admin-sync-modal,
.user-ticket-details-modal,
.reminder-modal,
#calendarModal,
#calendarEventModal,
#playlistModal,
#reminderModal {
    display: none !important;
    position: fixed !important;
    top: 80px !important; /* Move modals higher to cover more of the dashboard */
    left: 0 !important;
    width: 100vw !important;
    height: calc(100vh - 80px) !important; /* Adjust height to account for banner */
    background: rgba(0, 0, 0, 0.95) !important;
    backdrop-filter: blur(25px) !important;
    z-index: 2147483647 !important; /* Maximum z-index value */
    animation: modalFadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    right: auto !important;
    bottom: auto !important;
    min-width: auto !important;
    min-height: auto !important;
    max-width: none !important;
    max-height: none !important;
    transform: none !important;
    pointer-events: auto !important;
    isolation: isolate !important;
    contain: layout style paint !important;
}

.widget-modal.show,
.yam-modal-overlay.show,
.custom-date-modal.show,
.performance-modal.show,
.admin-sync-modal.show,
.user-ticket-details-modal.show,
.reminder-modal.show,
#calendarModal.show,
#calendarEventModal.show,
#playlistModal.show,
#reminderModal.show {
    display: flex !important;
    align-items: flex-start !important;
    justify-content: center !important;
    /* CRITICAL: Ensure complete isolation when modal is shown */
    position: fixed !important;
    top: 200px !important; /* Move modals much lower to avoid banner */
    left: 0 !important;
    width: 100vw !important;
    height: calc(100vh - 200px) !important; /* Adjust height to account for banner */
    background: rgba(0, 0, 0, 0.95) !important;
    backdrop-filter: blur(25px) !important;
    z-index: 2147483647 !important;
    pointer-events: auto !important;
    isolation: isolate !important;
    contain: layout style paint !important;
    padding-top: 60px !important; /* Add more top padding for better positioning */
}

/* PERFECT MODAL CENTERING AND SIZING */
.widget-modal-content,
.yam-modal-container,
.custom-date-content,
.performance-modal-content,
.admin-sync-modal-content,
.user-ticket-details-modal-content,
.reminder-modal-content {
    background: rgba(15, 15, 15, 0.98) !important;
    border-radius: 24px !important;
    width: 92% !important;
    max-width: 1000px !important;
    max-height: calc(75vh - 200px) !important; /* Make modal shorter */
    min-height: auto !important;
    height: auto !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.05) !important;
    backdrop-filter: blur(30px) !important;
    overflow: hidden !important;
    animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative !important;
    top: auto !important;
    left: auto !important;
    right: auto !important;
    bottom: auto !important;
    transform: translateY(-2vh) !important; /* Reduce transform for better positioning */
    margin: 0 auto !important;
    padding: 0 !important;
    min-width: auto !important;
    flex-direction: column !important;
    display: flex !important;
    /* Perfect centering */
    align-self: center !important;
    justify-self: center !important;
}

/* ENHANCED CALENDAR MODAL - SMALLER AND BETTER POSITIONED */
.calendar-modal-content {
    background: rgba(15, 15, 15, 0.98) !important;
    border-radius: 24px !important;
    width: 85% !important; /* Make modal smaller */
    max-width: 1000px !important; /* Reduce max width */
    height: calc(85vh - 80px) !important; /* Adjust for higher modal position */
    max-height: calc(85vh - 80px) !important; /* Adjust for higher modal position */
    min-height: calc(85vh - 80px) !important; /* Adjust for higher modal position */
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.05) !important;
    backdrop-filter: blur(30px) !important;
    overflow: hidden !important;
    animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative !important;
    top: auto !important;
    left: auto !important;
    right: auto !important;
    bottom: auto !important;
    transform: translateY(-6vh) !important; /* Move background higher */
    margin: 0 auto !important;
    padding: 0 !important;
    min-width: auto !important;
    flex-direction: column !important;
    display: flex !important;
    /* Perfect centering */
    align-self: center !important;
    justify-self: center !important;
}

/* EXACT ACTIVITY MODAL HEADER AND BODY STYLING */
.widget-modal-header,
.yam-modal-header,
.custom-date-header,
.performance-modal-header,
.admin-sync-modal-header,
.user-ticket-details-modal-header,
.reminder-modal-header {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 1.5rem 2rem !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    background: rgba(255, 255, 255, 0.02) !important;
    margin: 0 !important;
    border-radius: 0 !important;
    flex-shrink: 0 !important;
}

.widget-modal-header h3,
.yam-modal-header h3,
.custom-date-header h3,
.performance-modal-header h3,
.admin-sync-modal-header h3,
.user-ticket-details-modal-header h3,
.reminder-modal-header h3 {
    color: #ffffff !important;
    margin: 0 !important;
    font-size: 1.3rem !important;
    font-weight: 700 !important;
    display: flex !important;
    align-items: center !important;
    gap: 0.8rem !important;
}

.widget-modal-close,
.yam-modal-close,
.custom-date-close,
.performance-modal-close,
.admin-sync-modal-close,
.user-ticket-details-modal-close,
.reminder-modal-close {
    background: none !important;
    border: none !important;
    color: #888888 !important;
    font-size: 1.2rem !important;
    cursor: pointer !important;
    padding: 0.5rem !important;
    border-radius: 50% !important;
    width: 40px !important;
    height: 40px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    transition: all 0.3s ease !important;
}

.widget-modal-close:hover,
.yam-modal-close:hover,
.custom-date-close:hover,
.performance-modal-close:hover,
.admin-sync-modal-close:hover,
.user-ticket-details-modal-close:hover,
.reminder-modal-close:hover {
    background: rgba(255, 255, 255, 0.1) !important;
    color: #ffffff !important;
    transform: scale(1.1) !important;
}

.widget-modal-body,
.yam-modal-body,
.custom-date-body,
.performance-modal-body,
.admin-sync-modal-body,
.user-ticket-details-modal-body,
.reminder-modal-body {
    padding: 0.8rem !important;
    max-height: calc(90vh - 160px) !important; /* Adjust for higher modal position + header */
    height: auto !important;
    overflow-y: visible !important;
    overflow-x: hidden !important;
    flex: 1 !important;
    margin: 0 !important;
    border: none !important;
    background: transparent !important;
    /* Custom scrollbar for modal content */
    scrollbar-width: thin !important;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent !important;
}

/* ENHANCED CALENDAR MODAL BODY - SMALLER AND BETTER POSITIONED */
#calendarModal .widget-modal-body {
    padding: 1.5rem !important; /* Add more padding to move content down */
    max-height: calc(85vh - 200px) !important; /* Adjust for higher modal position + header */
    height: calc(85vh - 200px) !important; /* Adjust for higher modal position + header */
    overflow: hidden !important;
    flex: 1 !important;
    margin: 0 !important;
    border: none !important;
    background: transparent !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: flex-start !important; /* Ensure content starts from top */
    align-items: center !important; /* Center content horizontally */
}

/* Custom scrollbar styling for modal body */
.widget-modal-body::-webkit-scrollbar,
.yam-modal-body::-webkit-scrollbar,
.custom-date-body::-webkit-scrollbar,
.performance-modal-body::-webkit-scrollbar,
.admin-sync-modal-body::-webkit-scrollbar,
.user-ticket-details-modal-body::-webkit-scrollbar,
.reminder-modal-body::-webkit-scrollbar {
    width: 6px !important;
}

.widget-modal-body::-webkit-scrollbar-track,
.yam-modal-body::-webkit-scrollbar-track,
.custom-date-body::-webkit-scrollbar-track,
.performance-modal-body::-webkit-scrollbar-track,
.admin-sync-modal-body::-webkit-scrollbar-track,
.user-ticket-details-modal-body::-webkit-scrollbar-track,
.reminder-modal-body::-webkit-scrollbar-track {
    background: transparent !important;
}

.widget-modal-body::-webkit-scrollbar-thumb,
.yam-modal-body::-webkit-scrollbar-thumb,
.custom-date-body::-webkit-scrollbar-thumb,
.performance-modal-body::-webkit-scrollbar-thumb,
.admin-sync-modal-body::-webkit-scrollbar-thumb,
.user-ticket-details-modal-body::-webkit-scrollbar-thumb,
.reminder-modal-body::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3) !important;
    border-radius: 3px !important;
}

.widget-modal-body::-webkit-scrollbar-thumb:hover,
.yam-modal-body::-webkit-scrollbar-thumb:hover,
.custom-date-body::-webkit-scrollbar-thumb:hover,
.performance-modal-body::-webkit-scrollbar-thumb:hover,
.admin-sync-modal-body::-webkit-scrollbar-thumb:hover,
.user-ticket-details-modal-body::-webkit-scrollbar-thumb:hover,
.reminder-modal-body::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5) !important;
}
</style>

<!-- JAVASCRIPT - IN CORRECT ORDER -->
{% include 'components/yam/yam_core_scripts.html' %}
{% include 'components/yam/yam_modal_scripts.html' %}
{% include 'components/yam/yam_data_scripts.html' %}
{% include 'components/yam/yam_chart_and_management_scripts.html' %}
{% include 'components/yam/yam_outage_management_scripts.html' %}
{% include 'components/yam/yam_widget_scripts.html' %}
{% include 'components/yam/yam_user_tickets_scripts.html' %}

<!-- ENHANCED CHART INTERACTIONS FOR RESPONSIVE LAYOUT -->
<script>
// Enhanced chart interactions for responsive dashboard
document.addEventListener('DOMContentLoaded', function() {
    console.log('YAM: Initializing enhanced chart interactions for responsive layout');
    
    // Enhanced tooltip positioning for responsive charts
    function enhanceChartTooltips() {
        const charts = document.querySelectorAll('canvas');
        charts.forEach(canvas => {
            if (canvas.chart) {
                const chart = canvas.chart;
                const originalOptions = chart.options;
                
                // Ensure tooltip configuration exists
                if (!originalOptions.plugins) originalOptions.plugins = {};
                if (!originalOptions.plugins.tooltip) originalOptions.plugins.tooltip = {};
                
                // Enhanced tooltip callbacks for better data display
                if (!originalOptions.plugins.tooltip.callbacks) {
                    originalOptions.plugins.tooltip.callbacks = {};
                }
                
                // Ensure tooltips show on hover
                originalOptions.plugins.tooltip.enabled = true;
                originalOptions.plugins.tooltip.intersect = true;
                originalOptions.plugins.tooltip.mode = 'nearest';
                
                console.log(`âœ… Enhanced tooltip for chart: ${chart.id || 'unnamed'}`);
            }
        });
    }
    
    // Apply enhanced tooltip positioning after charts are rendered
    setTimeout(enhanceChartTooltips, 1000);
    
    // Re-apply after any dynamic chart updates
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList') {
                setTimeout(enhanceChartTooltips, 500);
            }
        });
    });
    
    observer.observe(document.body, { childList: true, subtree: true });
    
    // Monitor for chart updates and re-apply enhancements
    const chartUpdateObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'data-chart-updated') {
                setTimeout(enhanceChartTooltips, 100);
            }
        });
    });
    
    chartUpdateObserver.observe(document.body, { 
        attributes: true, 
        attributeFilter: ['data-chart-updated'],
        subtree: true 
    });
    
    console.log('YAM: Enhanced chart interactions initialized');
    
    // Specific enhancement for user tickets chart
    function enhanceUserTicketsChart() {
        const userTicketsCanvas = document.getElementById('userTicketsChart');
        if (userTicketsCanvas && userTicketsCanvas.chart) {
            const chart = userTicketsCanvas.chart;
            
                            // Ensure the chart has proper interaction settings
                if (chart.options) {
                    chart.options.onClick = function(event, elements) {
                        if (elements.length > 0) {
                            const element = elements[0];
                            const username = this.data.labels[element.index];
                            const ticketCount = this.data.datasets[0].data[element.index];
                            
                            console.log(`ðŸŽ¯ User clicked on ${username} with ${ticketCount} tickets`);
                            if (typeof openUserTicketDetailsModal === 'function') {
                                openUserTicketDetailsModal(username, ticketCount);
                            } else if (typeof showUserTicketDetails === 'function') {
                                showUserTicketDetails(username, ticketCount);
                            }
                        }
                    };
                
                // Ensure tooltips work properly
                if (!chart.options.plugins) chart.options.plugins = {};
                if (!chart.options.plugins.tooltip) chart.options.plugins.tooltip = {};
                
                chart.options.plugins.tooltip.enabled = true;
                chart.options.plugins.tooltip.intersect = true;
                chart.options.plugins.tooltip.mode = 'nearest';
                
                // Enhanced tooltip callbacks
                if (!chart.options.plugins.tooltip.callbacks) {
                    chart.options.plugins.tooltip.callbacks = {};
                }
                
                chart.options.plugins.tooltip.callbacks.title = function(context) {
                    return context[0].label; // Username
                };
                
                chart.options.plugins.tooltip.callbacks.label = function(context) {
                    const value = context.parsed.y;
                    return `${value} ticket${value !== 1 ? 's' : ''}`;
                };
                
                chart.options.plugins.tooltip.callbacks.afterLabel = function(context) {
                    return 'Click to view details';
                };
                
                console.log('âœ… User tickets chart enhanced for responsive interactions');
            }
        }
    }
    
    // Apply user tickets chart enhancement
    setTimeout(enhanceUserTicketsChart, 1500);
    
    // Re-apply user tickets chart enhancement after updates
    const userTicketsObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'childList') {
                setTimeout(enhanceUserTicketsChart, 500);
            }
        });
    });
    
    userTicketsObserver.observe(document.body, { childList: true, subtree: true });
    
    // Responsive layout monitoring
    function monitorResponsiveLayout() {
        const dashboardContainer = document.querySelector('.dashboard-container');
        const dashboardGrid = document.querySelector('.dashboard-grid');
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.yam-main-content');
        
        if (dashboardContainer && dashboardGrid && sidebar && mainContent) {
            // Ensure no gaps by monitoring layout changes
            const resizeObserver = new ResizeObserver(function(entries) {
                entries.forEach(function(entry) {
                    const element = entry.target;
                    
                    // Ensure proper width constraints
                    if (element.classList.contains('dashboard-container')) {
                        element.style.width = '100%';
                        element.style.maxWidth = '100%';
                    }
                    
                    if (element.classList.contains('dashboard-grid')) {
                        element.style.width = '100%';
                        element.style.maxWidth = '100%';
                    }
                    
                    if (element.classList.contains('sidebar')) {
                        element.style.width = '100%';
                        element.style.maxWidth = '350px';
                        element.style.minWidth = '320px';
                    }
                    
                    if (element.classList.contains('yam-main-content')) {
                        element.style.width = '100%';
                        element.style.minWidth = '0';
                        element.style.flex = '1';
                    }
                });
            });
            
            // Observe all layout elements
            resizeObserver.observe(dashboardContainer);
            resizeObserver.observe(dashboardGrid);
            resizeObserver.observe(sidebar);
            resizeObserver.observe(mainContent);
            
            console.log('âœ… Responsive layout monitoring initialized');
        }
    }
    
    // Initialize responsive layout monitoring
    setTimeout(monitorResponsiveLayout, 500);
});
</script>

<!-- EXACT ACTIVITY MODAL ANIMATIONS -->
<style>
@keyframes modalFadeIn {
    from { 
        opacity: 0; 
        backdrop-filter: blur(0px);
    }
    to { 
        opacity: 1; 
        backdrop-filter: blur(20px);
    }
}

@keyframes modalSlideIn {
    from { 
        opacity: 0;
        transform: translateY(-42vh) scale(0.95);
    }
    to { 
        opacity: 1;
        transform: translateY(-4vh) scale(1); /* Reduced offset since we're already below banner */
    }
}

/* ENHANCED CALENDAR MODAL ANIMATION */
#calendarModal .calendar-modal-content {
    animation: calendarModalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
}

@keyframes calendarModalSlideIn {
    from { 
        opacity: 0;
        transform: translateY(-4vh) scale(0.95); /* Reduced offset since we're already below banner */
    }
    to { 
        opacity: 1;
        transform: translateY(-4vh) scale(1); /* Reduced offset since we're already below banner */
    }
}

/* FORCE ALL MODALS TO USE ACTIVITY MODAL BEHAVIOR */
.widget-modal,
.yam-modal-overlay,
.custom-date-modal,
.performance-modal,
.admin-sync-modal,
.user-ticket-details-modal,
.reminder-modal,
#calendarModal,
#calendarEventModal,
#playlistModal,
#reminderModal {
    /* Override any conflicting CSS from other files */
    background-color: rgba(0, 0, 0, 0.85) !important;
    background-image: none !important;
    background: rgba(0, 0, 0, 0.85) !important;
}

/* Ensure content doesn't get full width/height overrides */
.widget-modal-content,
.yam-modal-container,
.custom-date-content,
.performance-modal-content,
.admin-sync-modal-content,
.user-ticket-details-modal-content,
.reminder-modal-content,
.calendar-modal-content {
    /* Force Activity Modal dimensions with proper centering */
    width: 92% !important;
    height: auto !important;
    max-width: 1000px !important;
    max-height: 90vh !important;
    min-height: auto !important;
    min-width: auto !important;
    transform: translateY(-8vh) !important;
    overflow: hidden !important;
}

/* IMPROVED CALENDAR STYLING */
.calendar-container {
    width: 100% !important;
    height: 100% !important;
    padding: 0.5rem !important;
    display: flex !important;
    flex-direction: column !important;
    gap: 0.8rem !important;
    min-height: auto !important;
    align-items: center !important;
    justify-content: flex-start !important;
    flex: 1 !important;
    overflow: hidden !important;
}

/* ENHANCED CALENDAR CONTAINER FOR MODAL - SMALLER AND BETTER POSITIONED */
#calendarModal .calendar-container {
    width: 100% !important;
    height: 100% !important;
    padding: 1rem !important; /* Add more padding to move content down */
    display: flex !important;
    flex-direction: column !important;
    gap: 1.5rem !important; /* Increase gap for better spacing */
    min-height: auto !important;
    align-items: center !important;
    justify-content: flex-start !important; /* Start from top */
    flex: 1 !important;
    overflow: hidden !important;
    margin-top: 1rem !important; /* Move content down */
}

.calendar-header {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    margin-bottom: 1rem !important; /* Increase bottom margin */
    margin-top: 0.5rem !important; /* Add top margin to move down */
    padding: 0 0.5rem !important;
    width: 90% !important; /* Match grid width */
    max-width: 700px !important; /* Match grid max width */
    margin-left: auto !important;
    margin-right: auto !important;
}

.calendar-header h4 {
    color: #ffffff !important;
    font-size: 1.2rem !important;
    font-weight: 600 !important;
    margin: 0 !important;
}

.calendar-nav-btn {
    background: rgba(255, 255, 255, 0.1) !important;
    border: none !important;
    color: #ffffff !important;
    padding: 0.5rem !important;
    border-radius: 50% !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    width: 36px !important;
    height: 36px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 1rem !important;
}

.calendar-nav-btn:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    transform: scale(1.1) !important;
}

/* PERFECT CALENDAR GRID */
.calendar-grid {
    display: grid !important;
    grid-template-columns: repeat(7, 1fr) !important;
    gap: 6px !important;
    width: 100% !important;
    max-width: 650px !important;
    background: rgba(255, 255, 255, 0.05) !important;
    border-radius: 12px !important;
    padding: 12px !important;
    aspect-ratio: 7/6.5 !important;
    min-height: 320px !important;
    margin: 0 auto !important;
    align-items: center !important;
    justify-items: center !important;
}

/* ENHANCED CALENDAR GRID FOR MODAL - SMALLER AND BETTER POSITIONED */
#calendarModal .calendar-grid {
    display: grid !important;
    grid-template-columns: repeat(7, 1fr) !important;
    gap: 6px !important; /* Slightly smaller gap */
    width: 90% !important; /* Make grid smaller */
    max-width: 700px !important; /* Reduce max width */
    background: rgba(255, 255, 255, 0.05) !important;
    border-radius: 16px !important;
    padding: 14px !important; /* Slightly smaller padding */
    height: calc(100% - 100px) !important; /* Adjust for higher modal position */
    min-height: 350px !important; /* Reduce minimum height */
    margin: 0 auto !important;
    align-items: center !important;
    justify-items: center !important;
    flex: 1 !important;
    overflow: hidden !important;
}

/* DAY HEADER STYLING */
.calendar-grid > div:nth-child(-n+7) {
    background: rgba(255, 255, 255, 0.1) !important;
    color: #cccccc !important;
    font-weight: 600 !important;
    font-size: 0.8rem !important;
    text-align: center !important;
    padding: 0 !important;
    border-radius: 6px !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
    width: 100% !important;
    height: 42px !important;
    min-height: 42px !important;
    max-height: 42px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    margin: 0 !important;
}

/* ENHANCED DAY HEADER STYLING FOR MODAL */
#calendarModal .calendar-grid > div:nth-child(-n+7) {
    background: rgba(255, 255, 255, 0.1) !important;
    color: #cccccc !important;
    font-weight: 600 !important;
    font-size: 0.9rem !important;
    text-align: center !important;
    padding: 0 !important;
    border-radius: 8px !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
    width: 100% !important;
    height: 50px !important;
    min-height: 50px !important;
    max-height: 50px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    margin: 0 !important;
}

/* CALENDAR DAY CELLS */
.calendar-day {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: rgba(25, 25, 25, 0.8) !important;
    border-radius: 6px !important;
    color: #ffffff !important;
    font-size: 0.95rem !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    position: relative !important;
    width: 100% !important;
    height: 42px !important;
    min-height: 42px !important;
    max-height: 42px !important;
    border: 1px solid rgba(255, 255, 255, 0.05) !important;
    margin: 0 !important;
    padding: 0 !important;
}

/* ENHANCED CALENDAR DAY CELLS FOR MODAL - TALLER AND MORE SPACIOUS */
#calendarModal .calendar-day {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: rgba(25, 25, 25, 0.8) !important;
    border-radius: 8px !important;
    color: #ffffff !important;
    font-size: 1.1rem !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.2s ease !important;
    position: relative !important;
    width: 100% !important;
    height: 60px !important;
    min-height: 60px !important;
    max-height: 60px !important;
    border: 1px solid rgba(255, 255, 255, 0.05) !important;
    margin: 0 !important;
    padding: 0 !important;
}

.calendar-day:hover {
    background: rgba(139, 92, 246, 0.15) !important;
    border-color: rgba(139, 92, 246, 0.3) !important;
    transform: scale(1.02) !important;
    box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2) !important;
}

.calendar-day.today {
    background: linear-gradient(135deg, #8b5cf6, #8b5cf6) !important;
    color: #ffffff !important;
    font-weight: 700 !important;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4) !important;
    border-color: rgba(255, 255, 255, 0.2) !important;
}

.calendar-day.other-month {
    color: #666666 !important;
    background: rgba(15, 15, 15, 0.4) !important;
    border-color: transparent !important;
}

.calendar-day.other-month:hover {
    background: rgba(255, 255, 255, 0.05) !important;
    color: #888888 !important;
}

/* CALENDAR QUICK ACTIONS */
.calendar-quick-actions {
    display: flex !important;
    gap: 0.8rem !important;
    margin-top: 1rem !important;
    padding: 0 0.5rem !important;
    width: 100% !important;
    max-width: 650px !important;
    margin-left: auto !important;
    margin-right: auto !important;
}

/* ENHANCED CALENDAR QUICK ACTIONS FOR MODAL */
#calendarModal .calendar-quick-actions {
    display: flex !important;
    gap: 1rem !important;
    margin-top: 1rem !important; /* Add more top margin to move down */
    padding: 0 0.5rem !important;
    width: 90% !important; /* Match grid width */
    max-width: 700px !important; /* Match grid max width */
    margin-left: auto !important;
    margin-right: auto !important;
    flex-shrink: 0 !important;
}

.calendar-quick-actions button {
    flex: 1 !important;
    padding: 0.6rem 0.8rem !important;
    border-radius: 8px !important;
    border: none !important;
    font-weight: 600 !important;
    font-size: 0.8rem !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 0.3rem !important;
    min-height: 36px !important;
}

/* ENHANCED CALENDAR QUICK ACTION BUTTONS FOR MODAL - BIGGER */
#calendarModal .calendar-quick-actions button {
    flex: 1 !important;
    padding: 0.8rem 1.2rem !important;
    border-radius: 12px !important;
    border: none !important;
    font-weight: 600 !important;
    font-size: 1rem !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 0.5rem !important;
    min-height: 48px !important;
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.1) !important;
    color: #ffffff !important;
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.2) !important;
    transform: translateY(-1px) !important;
}

.btn-primary {
    background: linear-gradient(135deg, #8b5cf6, #8b5cf6) !important;
    color: #ffffff !important;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #8b5cf6, #8b5cf6) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3) !important;
}

/* CRITICAL: Final fallback to ensure media player widget is hidden when any modal is active */
body:has(.widget-modal.show) .media-player-widget,
body:has(.yam-modal-overlay.show) .media-player-widget,
body:has(.custom-date-modal.show) .media-player-widget,
body:has(.performance-modal.show) .media-player-widget,
body:has(.admin-sync-modal.show) .media-player-widget,
body:has(.user-ticket-details-modal.show) .media-player-widget,
body:has(.reminder-modal.show) .media-player-widget,
body:has(#calendarModal.show) .media-player-widget,
body:has(#calendarEventModal.show) .media-player-widget,
body:has(#playlistModal.show) .media-player-widget,
body:has(#reminderModal.show) .media-player-widget,
body:has(.widget-modal.show) .widget.media-player-widget,
body:has(.yam-modal-overlay.show) .widget.media-player-widget,
body:has(.custom-date-modal.show) .widget.media-player-widget,
body:has(.performance-modal.show) .widget.media-player-widget,
body:has(.admin-sync-modal.show) .widget.media-player-widget,
body:has(.user-ticket-details-modal.show) .widget.media-player-widget,
body:has(.reminder-modal.show) .widget.media-player-widget,
body:has(#calendarModal.show) .widget.media-player-widget,
body:has(#calendarEventModal.show) .widget.media-player-widget,
body:has(#playlistModal.show) .widget.media-player-widget,
body:has(#reminderModal.show) .widget.media-player-widget {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
    pointer-events: none !important;
    position: absolute !important;
    z-index: -9999 !important;
    transform: translateX(-9999px) !important;
    width: 0 !important;
    height: 0 !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    margin: -1px !important;
    padding: 0 !important;
    border: 0 !important;
}

/* CRITICAL: Ensure modals are always positioned below sidebar banner */
.widget-modal.show,
.yam-modal-overlay.show,
.custom-date-modal.show,
.performance-modal.show,
.admin-sync-modal.show,
.user-ticket-details-modal.show,
.reminder-modal.show,
#calendarModal.show,
#calendarEventModal.show,
#playlistModal.show,
#reminderModal.show {
    top: 80px !important; /* Move modals higher to cover more of the dashboard */
    height: calc(100vh - 80px) !important; /* Adjusted height */
    z-index: 2147483647 !important; /* Maximum z-index */
}

/* ENHANCED USER TICKET DETAILS MODAL STYLING */
.user-ticket-details-modal {
    display: none !important;
    position: fixed !important;
    top: 120px !important;
    left: 0 !important;
    width: 100vw !important;
    height: calc(100vh - 120px) !important;
    background: rgba(0, 0, 0, 0.95) !important;
    backdrop-filter: blur(25px) !important;
    z-index: 2147483647 !important;
    animation: modalFadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    padding: 0 !important;
    margin: 0 !important;
    border: none !important;
    border-radius: 0 !important;
    pointer-events: auto !important;
    isolation: isolate !important;
    contain: layout style paint !important;
}

.user-ticket-details-modal.show {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

.user-ticket-details-modal-content {
    background: rgba(15, 15, 15, 0.98) !important;
    border-radius: 24px !important;
    width: 90% !important;
    max-width: 700px !important;
    max-height: calc(90vh - 120px) !important;
    min-height: auto !important;
    height: auto !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    box-shadow: 
        0 25px 50px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.05) !important;
    backdrop-filter: blur(30px) !important;
    overflow: hidden !important;
    animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative !important;
    transform: translateY(-2vh) !important;
    margin: 0 auto !important;
    padding: 0 !important;
    flex-direction: column !important;
    display: flex !important;
    align-self: center !important;
    justify-self: center !important;
}

.user-ticket-details-modal-header {
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    padding: 1.2rem 1.5rem !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
    background: rgba(255, 255, 255, 0.02) !important;
    margin: 0 !important;
    border-radius: 0 !important;
    flex-shrink: 0 !important;
}

.user-ticket-details-modal-header h3 {
    color: #ffffff !important;
    margin: 0 !important;
    font-size: 1.1rem !important;
    font-weight: 700 !important;
    display: flex !important;
    align-items: center !important;
    gap: 0.6rem !important;
}

.user-ticket-details-modal-close {
    background: none !important;
    border: none !important;
    color: #888888 !important;
    font-size: 1.2rem !important;
    cursor: pointer !important;
    padding: 0.5rem !important;
    border-radius: 50% !important;
    width: 40px !important;
    height: 40px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    transition: all 0.3s ease !important;
}

.user-ticket-details-modal-close:hover {
    background: rgba(255, 255, 255, 0.1) !important;
    color: #ffffff !important;
    transform: scale(1.1) !important;
}

.user-ticket-details-modal-body {
    padding: 1.5rem !important;
    max-height: calc(90vh - 200px) !important;
    height: auto !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    flex: 1 !important;
    margin: 0 !important;
    border: none !important;
    background: transparent !important;
    scrollbar-width: thin !important;
    scrollbar-color: rgba(255, 255, 255, 0.3) transparent !important;
}

.user-ticket-details-modal-body::-webkit-scrollbar {
    width: 6px !important;
}

.user-ticket-details-modal-body::-webkit-scrollbar-track {
    background: transparent !important;
}

.user-ticket-details-modal-body::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3) !important;
    border-radius: 3px !important;
}

.user-ticket-details-modal-body::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5) !important;
}

/* MODERN USER SUMMARY STYLES - IMPROVED LAYOUT */
.user-summary-modern {
    background: rgba(255, 255, 255, 0.03) !important;
    border-radius: 16px !important;
    padding: 1.2rem !important;
    margin-bottom: 1.5rem !important;
    border: 1px solid rgba(255, 255, 255, 0.05) !important;
    backdrop-filter: blur(10px) !important;
    position: relative !important;
    display: flex !important;
    justify-content: space-between !important;
    align-items: center !important;
    min-height: 80px !important;
}

.user-info-modern {
    display: flex !important;
    align-items: center !important;
    gap: 1rem !important;
    flex: 1 !important;
}

.user-avatar-modern {
    width: 60px !important;
    height: 60px !important;
    border-radius: 50% !important;
    overflow: hidden !important;
    background: linear-gradient(135deg, #8b5cf6, #8b5cf6) !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    font-size: 1.5rem !important;
    font-weight: 700 !important;
    color: #ffffff !important;
    flex-shrink: 0 !important;
    border: 2px solid rgba(139, 92, 246, 0.3) !important;
}

.user-avatar-modern img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
}

.user-details-modern {
    flex: 1 !important;
}

.user-name-modern {
    color: #ffffff !important;
    font-size: 1.4rem !important;
    font-weight: 700 !important;
    margin: 0 0 0.3rem 0 !important;
}

.user-role-modern {
    color: #cccccc !important;
    font-size: 0.9rem !important;
    margin: 0 0 0.2rem 0 !important;
    font-weight: 500 !important;
}

.user-date-modern {
    color: #888888 !important;
    font-size: 0.85rem !important;
    margin: 0 !important;
}

.summary-stats-modern {
    display: flex !important;
    gap: 0 !important;
    justify-content: flex-end !important;
    align-items: center !important;
    margin-left: auto !important;
}

.stat-item-modern {
    text-align: center !important;
    padding: 1rem 1.2rem !important;
    background: rgba(139, 92, 246, 0.15) !important;
    border-radius: 12px !important;
    border: 1px solid rgba(139, 92, 246, 0.3) !important;
    min-width: 100px !important;
    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.1) !important;
}

.stat-number-modern {
    color: #8b5cf6 !important;
    font-size: 1.8rem !important;
    font-weight: 700 !important;
    margin-bottom: 0.2rem !important;
    text-shadow: 0 0 10px rgba(139, 92, 246, 0.3) !important;
}

.stat-label-modern {
    color: #cccccc !important;
    font-size: 0.75rem !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 0.5px !important;
}

/* MODERN TICKET LIST STYLES - WIDER ENTRIES */
.ticket-list-item {
    background: rgba(255, 255, 255, 0.02) !important;
    border: 1px solid rgba(255, 255, 255, 0.05) !important;
    border-radius: 12px !important;
    padding: 1.2rem 1.5rem !important;
    margin-bottom: 0.8rem !important;
    cursor: pointer !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    position: relative !important;
    overflow: hidden !important;
    width: 100% !important;
    box-sizing: border-box !important;
}

.ticket-list-item:hover {
    background: rgba(139, 92, 246, 0.08) !important;
    border-color: rgba(139, 92, 246, 0.3) !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 8px 25px rgba(139, 92, 246, 0.15) !important;
}

.ticket-list-item:active {
    transform: translateY(0) !important;
    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.2) !important;
}

.ticket-item-content {
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    gap: 1.5rem !important;
    width: 100% !important;
}

.ticket-number-display {
    display: flex !important;
    align-items: center !important;
    gap: 0.3rem !important;
    font-weight: 600 !important;
    flex: 1 !important;
}

.ticket-prefix {
    color: #8b5cf6 !important;
    font-size: 1.1rem !important;
    font-weight: 700 !important;
}

.ticket-id {
    color: #ffffff !important;
    font-size: 1.2rem !important;
    font-weight: 700 !important;
}

.ticket-action-indicator {
    color: #8b5cf6 !important;
    font-size: 1.4rem !important;
    opacity: 0.7 !important;
    transition: all 0.3s ease !important;
    flex-shrink: 0 !important;
}

.ticket-list-item:hover .ticket-action-indicator {
    opacity: 1 !important;
    transform: scale(1.1) !important;
}

/* NO TICKETS STATE */
.no-tickets-state {
    text-align: center !important;
    padding: 3rem 2rem !important;
    color: #888888 !important;
}

/* RESPONSIVE IMPROVEMENTS FOR USER TICKET DETAILS MODAL */
@media (max-width: 768px) {
    .user-summary-modern {
        flex-direction: column !important;
        gap: 1rem !important;
        text-align: center !important;
        padding: 1.5rem !important;
    }
    
    .user-info-modern {
        justify-content: center !important;
    }
    
    .summary-stats-modern {
        justify-content: center !important;
        margin-left: 0 !important;
    }
    
    .ticket-list-item {
        padding: 1rem 1.2rem !important;
    }
    
    .ticket-item-content {
        gap: 1rem !important;
    }
    
    .ticket-prefix {
        font-size: 1rem !important;
    }
    
    .ticket-id {
        font-size: 1.1rem !important;
    }
}

.no-tickets-icon {
    font-size: 3rem !important;
    color: #666666 !important;
    margin-bottom: 1rem !important;
}

.no-tickets-state h4 {
    color: #cccccc !important;
    font-size: 1.2rem !important;
    font-weight: 600 !important;
    margin: 0 0 0.5rem 0 !important;
}

.no-tickets-state p {
    color: #888888 !important;
    font-size: 0.9rem !important;
    margin: 0 !important;
    line-height: 1.5 !important;
}

/* LOADING STATE */
.loading-state {
    text-align: center !important;
    padding: 3rem 2rem !important;
    color: #888888 !important;
}

.loading-spinner {
    width: 40px !important;
    height: 40px !important;
    border: 3px solid rgba(139, 92, 246, 0.2) !important;
    border-top: 3px solid #8b5cf6 !important;
    border-radius: 50% !important;
    animation: spin 1s linear infinite !important;
    margin: 0 auto 1rem auto !important;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.loading-state p {
    color: #cccccc !important;
    font-size: 1rem !important;
    margin: 0 !important;
}

/* ERROR STATE */
.error-state {
    text-align: center !important;
    padding: 3rem 2rem !important;
    color: #ff6b6b !important;
}

.error-state i {
    font-size: 3rem !important;
    margin-bottom: 1rem !important;
}

.error-state h4 {
    color: #ff6b6b !important;
    font-size: 1.2rem !important;
    font-weight: 600 !important;
    margin: 0 0 0.5rem 0 !important;
}

.error-state p {
    color: #ff8e8e !important;
    font-size: 0.9rem !important;
    margin: 0 0 1rem 0 !important;
}

.error-state button {
    background: #8b5cf6 !important;
    color: #ffffff !important;
    border: none !important;
    padding: 0.8rem 1.5rem !important;
    border-radius: 8px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
}

.error-state button:hover {
    background: #7c3aed !important;
    transform: translateY(-1px) !important;
}
</style>

<!-- Simple JavaScript matching Activity Modal -->
<script>

// ENHANCED MODAL FUNCTIONS WITH BODY SCROLL LOCK AND ELEMENT ISOLATION
// Make functions globally available for other components
// CRITICAL: Enhanced page scrollbar management
window.disablePageScrollbar = function() {
    // Calculate scrollbar width to prevent layout shift
    const scrollbarWidth = window.innerWidth - document.documentElement.clientWidth;
    
    // Store original styles for restoration
    window.originalBodyOverflow = document.body.style.overflow;
    window.originalDocumentOverflow = document.documentElement.style.overflow;
    window.originalBodyPaddingRight = document.body.style.paddingRight;
    
    // Completely disable page scrolling
    document.body.style.overflow = 'hidden';
    document.documentElement.style.overflow = 'hidden';
    
    // Prevent layout shift by adding padding equal to scrollbar width
    document.body.style.paddingRight = `${scrollbarWidth}px`;
    
    // Add modal-open class for additional CSS targeting
    document.body.classList.add('modal-open');
    document.documentElement.classList.add('modal-open');
    
    console.log('ðŸ”’ Page scrollbar completely disabled with layout shift prevention');
};

window.enablePageScrollbar = function() {
    // Restore original styles
    document.body.style.overflow = window.originalBodyOverflow || '';
    document.documentElement.style.overflow = window.originalDocumentOverflow || '';
    document.body.style.paddingRight = window.originalBodyPaddingRight || '';
    
    // Remove modal-open classes
    document.body.classList.remove('modal-open');
    document.documentElement.classList.remove('modal-open');
    
    // Clear stored values
    window.originalBodyOverflow = undefined;
    window.originalDocumentOverflow = undefined;
    window.originalBodyPaddingRight = undefined;
    
    console.log('ðŸ”“ Page scrollbar restored with original layout');
};

// CRITICAL: Function to specifically hide media player widget
window.hideMediaPlayerWidget = function() {
    const mediaPlayerWidgets = document.querySelectorAll('.media-player-widget, .widget.media-player-widget');
    mediaPlayerWidgets.forEach(widget => {
        widget.style.display = 'none';
        widget.style.visibility = 'hidden';
        widget.style.opacity = '0';
        widget.style.pointerEvents = 'none';
        widget.style.position = 'absolute';
        widget.style.zIndex = '-9999';
        widget.style.transform = 'translateX(-9999px)';
        widget.style.width = '0';
        widget.style.height = '0';
        widget.style.overflow = 'hidden';
    });
    console.log('ðŸ”’ Media player widget specifically hidden');
};

// CRITICAL: Function to specifically show media player widget
window.showMediaPlayerWidget = function() {
    const mediaPlayerWidgets = document.querySelectorAll('.media-player-widget, .widget.media-player-widget');
    mediaPlayerWidgets.forEach(widget => {
        widget.style.display = '';
        widget.style.visibility = '';
        widget.style.opacity = '';
        widget.style.pointerEvents = '';
        widget.style.position = '';
        widget.style.zIndex = '';
        widget.style.transform = '';
        widget.style.width = '';
        widget.style.height = '';
        widget.style.overflow = '';
    });
    console.log('ðŸ”“ Media player widget specifically restored');
};

window.hideAllNonModalElements = function() {
    // CRITICAL: Disable page scrollbar first
    disablePageScrollbar();
    
    // Hide all dashboard containers and widgets when modal is open
    const elementsToHide = [
        '.dashboard-container',
        '.sidebar',
        '.yam-main-content',
        '.charts-grid',
        '.dashboard-widgets',
        '.user-profile',
        '.welcome-header',
        '.directory-grid'
    ];
    
    elementsToHide.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(element => {
            element.style.visibility = 'hidden';
            element.style.pointerEvents = 'none';
        });
    });
    
    // CRITICAL: Specifically target media player widget with stronger hiding
    hideMediaPlayerWidget();
    
    console.log('ðŸ”’ Hidden all non-modal elements and disabled page scrollbar');
}

window.showAllNonModalElements = function() {
    // CRITICAL: Re-enable page scrollbar first
    enablePageScrollbar();
    
    // Show all dashboard containers and widgets when modal is closed
    const elementsToShow = [
        '.dashboard-container',
        '.sidebar',
        '.yam-main-content',
        '.charts-grid',
        '.dashboard-widgets',
        '.user-profile',
        '.welcome-header',
        '.directory-grid'
    ];
    
    elementsToShow.forEach(selector => {
        const elements = document.querySelectorAll(selector);
        elements.forEach(element => {
            element.style.visibility = '';
            element.style.pointerEvents = '';
        });
    });
    
    // CRITICAL: Restore media player widget with proper styling
    showMediaPlayerWidget();
    
    console.log('ðŸ”“ Restored all non-modal elements and re-enabled page scrollbar');
}

window.openCalendarModal = function() {
    const modal = document.getElementById('calendarModal');
    if (modal) {
        // Hide all non-modal elements first (this now handles scrollbar disabling)
        hideAllNonModalElements();
        
        // Adjust modal positioning for banner height
        if (typeof adjustModalPositioning === 'function') {
            adjustModalPositioning();
        }
        
        modal.classList.add('show');
        
        // Render calendar content
        setTimeout(() => {
            if (typeof renderCalendarForModal === 'function') {
                renderCalendarForModal();
            } else if (typeof renderCalendar === 'function') {
                renderCalendar();
            }
        }, 50);
    }
}

window.closeCalendarModal = function() {
    const modal = document.getElementById('calendarModal');
    if (modal) {
        modal.classList.remove('show');
        // Show all non-modal elements (this now handles scrollbar restoration)
        showAllNonModalElements();
    }
}

window.openCalendarEventModal = function() {
    const modal = document.getElementById('calendarEventModal');
    if (modal) {
        // Hide all non-modal elements first (this now handles scrollbar disabling)
        hideAllNonModalElements();
        
        // Adjust modal positioning for banner height
        if (typeof adjustModalPositioning === 'function') {
            adjustModalPositioning();
        }
        
        modal.classList.add('show');
        
        // Set today's date as default
        const today = new Date();
        const eventStartDate = document.getElementById('eventStartDate');
        const eventEndDate = document.getElementById('eventEndDate');
        
        if (eventStartDate) eventStartDate.value = today.toISOString().split('T')[0];
        if (eventEndDate) eventEndDate.value = today.toISOString().split('T')[0];
    }
}

window.closeCalendarEventModal = function() {
    const modal = document.getElementById('calendarEventModal');
    if (modal) {
        modal.classList.remove('show');
        // Show all non-modal elements (this now handles scrollbar restoration)
        showAllNonModalElements();
        // Reset the form
        const form = document.getElementById('calendarForm');
        if (form) form.reset();
    }
}

window.openReminderModal = function() {
    // Use calendar event modal for reminders
    openCalendarEventModal();
}

// Enhanced function to open user ticket details modal with proper positioning
window.openUserTicketDetailsModal = function(username, ticketCount) {
    console.log(`ðŸ” Opening user ticket details modal for ${username} with ${ticketCount} tickets`);
    
    // Hide all non-modal elements first (this now handles scrollbar disabling)
    hideAllNonModalElements();
    
    // Adjust modal positioning for banner height
    if (typeof window.adjustModalPositioning === 'function') {
        window.adjustModalPositioning();
    }
    
    // Call the existing showUserTicketDetails function if it exists
    if (typeof showUserTicketDetails === 'function') {
        showUserTicketDetails(username, ticketCount);
    } else {
        console.error('âŒ showUserTicketDetails function not found');
    }
}

window.openPlaylistModal = function() {
    const modal = document.getElementById('playlistModal');
    if (modal) {
        // Hide all non-modal elements first (this now handles scrollbar disabling)
        hideAllNonModalElements();
        
        // Adjust modal positioning for banner height
        if (typeof adjustModalPositioning === 'function') {
            adjustModalPositioning();
        }
        
        modal.classList.add('show');
        
        // Render playlist content if the function exists
        setTimeout(() => {
            if (typeof renderPlaylist === 'function') {
                renderPlaylist();
            }
        }, 50);
    }
}

window.closePlaylistModal = function() {
    const modal = document.getElementById('playlistModal');
    if (modal) {
        modal.classList.remove('show');
        // Show all non-modal elements (this now handles scrollbar restoration)
        showAllNonModalElements();
    }
}

// Enhanced initialization with ESC key support, click-outside, and cleanup
document.addEventListener('DOMContentLoaded', function() {
    console.log('YAM Dashboard: Enhanced modal system loaded');
    
    // Function to dynamically adjust modal positioning based on banner height
    window.adjustModalPositioning = function() {
        const sidebarBanner = document.querySelector('.sidebar-banner');
        let bannerHeight = 80; // Move modals higher to cover more of the dashboard
        
        // Try to get actual banner height and add minimal padding
        if (sidebarBanner) {
            bannerHeight = sidebarBanner.offsetHeight + 0; // No extra padding to cover more dashboard
            // Ensure minimum height for safety
            if (bannerHeight < 60) bannerHeight = 80;
        }
        
        console.log(`ðŸŽ¯ Adjusting modal positioning for banner height: ${bannerHeight}px`);
        
        // Update all modal positioning with fallback safety
        const allModals = document.querySelectorAll('.widget-modal, .yam-modal-overlay, .custom-date-modal, .performance-modal, .admin-sync-modal, .user-ticket-details-modal, .reminder-modal, #calendarModal, #calendarEventModal, #playlistModal, #reminderModal, .user-ticket-details-modal');
        
        allModals.forEach(modal => {
            modal.style.top = `${bannerHeight}px`;
            modal.style.height = `calc(100vh - ${bannerHeight}px)`;
            // Ensure modal is always visible
            modal.style.zIndex = '2147483647';
            modal.style.position = 'fixed';
        });
        
        // Update modal content max heights
        const modalContents = document.querySelectorAll('.widget-modal-content, .yam-modal-container, .custom-date-content, .performance-modal-content, .admin-sync-modal-content, .user-ticket-details-modal-content, .reminder-modal-content');
        
        modalContents.forEach(content => {
            content.style.maxHeight = `calc(90vh - ${bannerHeight}px)`;
            // Ensure content is properly positioned
            content.style.position = 'relative';
            content.style.zIndex = '2147483647';
        });
        
        // Update calendar modal content specifically
        const calendarModalContent = document.querySelector('.calendar-modal-content');
        if (calendarModalContent) {
            calendarModalContent.style.height = `calc(95vh - ${bannerHeight}px)`;
            calendarModalContent.style.maxHeight = `calc(95vh - ${bannerHeight}px)`;
            calendarModalContent.style.minHeight = `calc(95vh - ${bannerHeight}px)`;
        }
        
        // Update modal body max heights
        const modalBodies = document.querySelectorAll('.widget-modal-body, .yam-modal-body, .custom-date-body, .performance-modal-body, .admin-sync-modal-body, .user-ticket-details-modal-body, .reminder-modal-body');
        
        modalBodies.forEach(body => {
            body.style.maxHeight = `calc(90vh - ${bannerHeight + 80}px)`; // banner + header
        });
        
        // Update calendar modal body specifically
        const calendarModalBody = document.querySelector('#calendarModal .widget-modal-body');
        if (calendarModalBody) {
            calendarModalBody.style.maxHeight = `calc(95vh - ${bannerHeight + 100}px)`; // banner + header
            calendarModalBody.style.height = `calc(95vh - ${bannerHeight + 100}px)`;
        }
        
        // CRITICAL: Ensure modals are always above the sidebar banner
        const sidebarFixed = document.querySelector('.sidebar-fixed');
        if (sidebarFixed) {
            const sidebarZIndex = parseInt(window.getComputedStyle(sidebarFixed).zIndex) || 9999999;
            const modalZIndex = Math.max(sidebarZIndex + 1, 2147483647);
            
            allModals.forEach(modal => {
                modal.style.zIndex = modalZIndex.toString();
            });
        }
    }
    
    // Initial adjustment
    window.adjustModalPositioning();
    
    // Adjust on window resize
    window.addEventListener('resize', window.adjustModalPositioning);
    
    // Ensure no modals are open on load and restore scrolling
    const allModals = document.querySelectorAll('.widget-modal, .yam-modal-overlay, .custom-date-modal, .reminder-modal, #calendarModal, #calendarEventModal, #playlistModal, #reminderModal');
    allModals.forEach(modal => modal.classList.remove('show'));
    
    // Ensure all non-modal elements are visible on page load
    showAllNonModalElements();
    
    // Ensure page scrollbar is enabled on page load
    enablePageScrollbar();
    
    // Add click-outside-to-close functionality
    allModals.forEach(modal => {
        modal.addEventListener('click', function(event) {
            // Only close if clicking the modal overlay (not the content)
            if (event.target === modal) {
                console.log(`ðŸ–±ï¸ Click outside modal detected for: ${modal.id || modal.className}`);
                
                // Close the appropriate modal with proper scroll restoration
                if (modal.id === 'calendarModal') {
                    closeCalendarModal();
                } else if (modal.id === 'calendarEventModal') {
                    closeCalendarEventModal();
                } else if (modal.id === 'playlistModal') {
                    closePlaylistModal();
                } else if (modal.id === 'userTicketDetailsModal') {
                    // Close user ticket details modal
                    if (typeof closeUserTicketDetailsModal === 'function') {
                        closeUserTicketDetailsModal();
                    } else {
                        modal.classList.remove('show');
                        showAllNonModalElements();
                    }
                } else {
                    // Generic close with scroll restoration
                    modal.classList.remove('show');
                    showAllNonModalElements();
                }
            }
        });
    });
    
    // ESC key support for closing modals
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            // Find any open modal
            const openModal = document.querySelector('.widget-modal.show, .yam-modal-overlay.show, .custom-date-modal.show, .reminder-modal.show, #calendarModal.show, #calendarEventModal.show, #playlistModal.show, #reminderModal.show, .user-ticket-details-modal.show');
            if (openModal) {
                console.log(`âŒ¨ï¸ ESC key pressed, closing modal: ${openModal.id || openModal.className}`);
                
                // Close the appropriate modal
                if (openModal.id === 'calendarModal') {
                    closeCalendarModal();
                } else if (openModal.id === 'calendarEventModal') {
                    closeCalendarEventModal();
                } else if (openModal.id === 'playlistModal') {
                    closePlaylistModal();
                } else if (openModal.id === 'userTicketDetailsModal') {
                    // Close user ticket details modal
                    if (typeof closeUserTicketDetailsModal === 'function') {
                        closeUserTicketDetailsModal();
                    } else {
                        openModal.classList.remove('show');
                        showAllNonModalElements();
                    }
                } else {
                    // Generic close
                    openModal.classList.remove('show');
                    showAllNonModalElements();
                }
            }
        }
    });
    
    // Cleanup on page unload
    window.addEventListener('beforeunload', function() {
        enablePageScrollbar();
        showAllNonModalElements();
    });
    
    // CRITICAL: Monitor for any modal state changes and ensure proper isolation
    const modalObserver = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                const modal = mutation.target;
                if (modal.classList.contains('show')) {
                    // Modal was opened - ensure all other elements are hidden
                    hideAllNonModalElements();
                    
                    // CRITICAL: Force hide media player widget specifically
                    hideMediaPlayerWidget();
                    
                    // CRITICAL: Force disable page scrollbar as fallback
                    document.body.style.overflow = 'hidden';
                    document.documentElement.style.overflow = 'hidden';
                    document.body.classList.add('modal-open');
                    document.documentElement.classList.add('modal-open');
                    
                    // Adjust modal positioning for banner height
                    if (typeof window.adjustModalPositioning === 'function') {
                        setTimeout(() => window.adjustModalPositioning(), 10);
                    }
                } else {
                    // Modal was closed - ensure all elements are visible
                    showAllNonModalElements();
                    
                    // CRITICAL: Force re-enable page scrollbar as fallback
                    document.body.style.overflow = '';
                    document.documentElement.style.overflow = '';
                    document.body.classList.remove('modal-open');
                    document.documentElement.classList.remove('modal-open');
                }
            }
        });
    });
    
    // Observe all modal elements for class changes
    const allModals = document.querySelectorAll('.widget-modal, .yam-modal-overlay, .custom-date-modal, .reminder-modal, #calendarModal, #calendarEventModal, #playlistModal, #reminderModal, .user-ticket-details-modal');
    allModals.forEach(modal => {
        modalObserver.observe(modal, { attributes: true, attributeFilter: ['class'] });
    });
    
    console.log('âœ… Modal isolation system initialized');
});
</script>
{% endblock %}