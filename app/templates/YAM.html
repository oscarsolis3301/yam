{% extends "base.html" %}

{% block content %}
<!-- Include all styles -->
{% include 'components/yam/yam_dashboard_styles.html' %}

<div class="dashboard-container">
    <!-- Welcome Header -->
    {% include 'components/yam/yam_welcome_header.html' %}

    <!-- Main Dashboard Grid - Optimized Layout -->
    <div class="dashboard-grid">
        <!-- Sidebar (left side) - Enhanced with Expanded Reminders -->
        <div class="sidebar">
            <!-- Enhanced User Profile with Expanded Reminders Above -->
            {% include 'components/yam/yam_user_profile.html' %}
        </div>

        <!-- Main Content (right side) - Optimized -->
        <div class="yam-main-content">
            <!-- Charts Grid - Side by Side Layout -->
            <div class="charts-grid">
                <!-- Outages Section -->
                {% include 'components/yam/yam_outages_section.html' %}
                
                <!-- User Tickets Section -->
                {% include 'components/yam/yam_user_tickets_section.html' %}
            </div>
            
            <!-- Dashboard Widgets - Media Player replaces Calendar -->
            {% include 'components/yam/yam_dashboard_widgets.html' %}
        </div>
    </div>

    <!-- Navigation Directory -->
    {% include 'components/yam/yam_navigation_directory.html' %}
</div>

<!-- Modals -->
{% include 'components/yam/yam_outage_detail_modal.html' %}
{% include 'components/yam/yam_custom_date_modal.html' %}
{% include 'components/yam/yam_outages_management_modal.html' %}

<!-- Include all JavaScript -->
{% include 'components/yam/yam_core_scripts.html' %}
{% include 'components/yam/yam_modal_scripts.html' %}
{% include 'components/yam/yam_data_scripts.html' %}
{% include 'components/yam/yam_chart_and_management_scripts.html' %}
{% include 'components/yam/yam_outage_management_scripts.html' %}
{% include 'components/yam/yam_widget_scripts.html' %}
{% include 'components/yam/yam_user_tickets_scripts.html' %}

<style>
/* YAM Layout Enhancements - Optimized Flow */
.dashboard-container {
    gap: 0.8rem; /* Reduced gap for tighter layout */
}

.dashboard-grid {
    gap: 0.8rem; /* Reduced gap */
    min-height: auto; /* Remove fixed height */
}

.yam-main-content {
    gap: 0.8rem; /* Reduced gap */
    height: auto; /* Remove fixed height */
}

.charts-grid {
    gap: 0.8rem; /* Reduced gap */
    margin-bottom: 0.8rem; /* Reduced margin */
}

/* Responsive optimizations */
@media (max-width: 1200px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
        gap: 0.6rem;
    }
    
    .sidebar {
        order: -1; /* Keep reminders at top on mobile */
    }
    
    .charts-grid {
        grid-template-columns: 1fr;
        gap: 0.6rem;
    }
}

@media (max-width: 768px) {
    .dashboard-container {
        gap: 0.5rem;
        padding: 0.5rem;
    }
    
    .dashboard-grid {
        gap: 0.5rem;
    }
    
    .yam-main-content {
        gap: 0.5rem;
    }
    
    .charts-grid {
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }
}
</style>

<script>
// Enhanced YAM Dashboard Initialization
document.addEventListener('DOMContentLoaded', function() {
    console.log('YAM Dashboard Enhanced - Loaded');
    
    // Initialize all components
    if (typeof loadReminders === 'function') {
        loadReminders();
    }
    
    if (typeof loadCalendarEvents === 'function') {
        loadCalendarEvents();
    }
    
    if (typeof renderCalendar === 'function') {
        renderCalendar();
    }
    
    if (typeof renderExpandedReminders === 'function') {
        renderExpandedReminders();
    }
    
    // Add smooth scroll behavior
    document.documentElement.style.scrollBehavior = 'smooth';
    
    // Show welcome message
    setTimeout(() => {
        if (typeof showToast === 'function') {
            showToast('Welcome to your enhanced YAM Dashboard!', 'success');
        }
    }, 1000);
});

// Enhanced calendar modal opening from reminders widget
function openCalendarModal() {
    const modal = document.getElementById('calendarModal');
    if (modal) {
        modal.classList.add('show');
        // Ensure calendar is rendered when modal opens
        if (typeof renderCalendar === 'function') {
            renderCalendar();
        }
    }
}

function closeCalendarModal() {
    const modal = document.getElementById('calendarModal');
    if (modal) {
        modal.classList.remove('show');
    }
}
</script>
{% endblock %}
